<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Sisa Limit Dezz</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    margin:0;
    font-family: 'Segoe UI', Roboto, Arial, sans-serif;
    background:#f4f6f8;
    display:flex;
    justify-content:center;
    padding:12px 0;
  }
  .card {
    width:95%;
    max-width:400px;
    background:#fff;
    border-radius:14px;
    padding:20px;
    box-shadow:0 8px 20px rgba(0,0,0,0.06);
    text-align:center;
  }
  h1{font-size:20px;color:#111;margin-bottom:10px;}
  .stat{margin:12px 0;}
  .label{font-size:12px;color:#6b7280;margin-bottom:4px;text-transform:uppercase;}
  .value{font-size:28px;font-weight:700;color:#0f172a;}
  #chart{margin-top:18px;}
  .statusBox{
    margin-top:10px;
    font-weight:600;
    padding:6px 12px;
    border-radius:999px;
    display:inline-block;
    font-size:12px;
    color:white;
  }
</style>
</head>
<body>

<div class="card">
  <h1>Sisa Limit Punya Dezz</h1>
  <div class="stat">
    <div class="label">Limit</div>
    <div id="limit" class="value">—</div>
  </div>
  <div class="stat">
    <div class="label">Today Hit</div>
    <div id="todayHit" class="value">—</div>
  </div>
  <canvas id="chart" height="120"></canvas>
  <div id="statusBox" class="statusBox">Loading...</div>
</div>

<script>
const $ = id => document.getElementById(id);
let chart;

function setStatus(text,color){
  $.statusBox.textContent = text;
  $.statusBox.style.backgroundColor = color;
}

async function loadLimit(){
  try{
    const res = await fetch('https://dezz-apie.vercel.app/api/checkkey',{cache:'no-store'});
    if(res.status===200){
      setStatus('200 OK','green');
    } else if(res.status>=500){
      setStatus(res.status+' Server Error','red');
    } else{
      setStatus(res.status+' Error','orange');
    }
    const data = await res.json();
    const limit = Number.isFinite(data.result.limit)?data.result.limit:0;
    const today = Number.isFinite(data.result.todayHit)?data.result.todayHit:0;
    const remaining = Math.max(0,limit-today);

    $.limit.textContent = limit.toLocaleString('id');
    $.todayHit.textContent = today.toLocaleString('id');

    if(!chart){
      const ctx = $.chart.getContext('2d');
      chart = new Chart(ctx,{
        type:'bar',
        data:{
          labels:['TodayHit','Sisa Limit'],
          datasets:[{
            data:[today,remaining],
            backgroundColor:['#0ea5e9','#cbd5e1'],
            borderRadius:6
          }]
        },
        options:{
          plugins:{legend:{display:false}},
          scales:{y:{beginAtZero:true,ticks:{precision:0}}},
          maintainAspectRatio:false
        }
      });
    } else{
      chart.data.datasets[0].data = [today,remaining];
      chart.update();
    }
  } catch(e){
    setStatus('Jaringan Error','orange');
  }
}

loadLimit();
setInterval(loadLimit,10000);
</script>

</body>
</html>
