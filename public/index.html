<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sisa Limit Dezz</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {margin:0;padding:0;box-sizing:border-box}
    body {
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      background: #f4f6f8;
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:100vh;
    }
    .card {
      background:#fff;
      padding:32px 24px;
      border-radius:16px;
      box-shadow:0 10px 30px rgba(0,0,0,0.08);
      text-align:center;
      max-width:400px;
      width:90%;
    }
    h1 {
      font-size:24px;
      margin-bottom:24px;
      color:#333;
    }
    .label {
      font-size:14px;
      color:#888;
      margin-bottom:6px;
      text-transform:uppercase;
      letter-spacing:0.5px;
    }
    .value {
      font-size:32px;
      font-weight:700;
      color:#111;
      margin-bottom:16px;
    }
    canvas {
      margin-top:20px;
    }
    .footer {
      font-size:12px;
      color:#aaa;
      margin-top:16px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Sisa Limit Punya Dezz</h1>

    <div class="label">Limit</div>
    <div id="limit" class="value">Loading...</div>

    <div class="label">Today Hit</div>
    <div id="todayHit" class="value">Loading...</div>

    <canvas id="chart" width="300" height="150"></canvas>

    <div class="footer">Data update otomatis tiap 10 detik</div>
  </div>

  <script>
    let chart;

    async function loadLimit() {
      try {
        const res = await fetch('/api/checklimit');
        const data = await res.json();
        const limit = data.limit ?? 0;
        const today = data.todayHit ?? 0;

        document.getElementById('limit').textContent = limit;
        document.getElementById('todayHit').textContent = today;

        // Update chart
        if (!chart) {
          const ctx = document.getElementById('chart').getContext('2d');
          chart = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: ['TodayHit','Sisa Limit'],
              datasets: [{
                label: 'Penggunaan API',
                data: [today, limit - today],
                backgroundColor: ['#4caf50','#ddd'],
                borderRadius: 6,
              }]
            },
            options: {
              responsive:true,
              plugins: { legend: { display: false } },
              scales: {
                y: { beginAtZero:true }
              }
            }
          });
        } else {
          chart.data.datasets[0].data = [today, limit - today];
          chart.update();
        }
      } catch(e) {
        console.error(e);
        document.getElementById('limit').textContent = 'Error';
        document.getElementById('todayHit').textContent = 'Error';
      }
    }

    loadLimit();
    setInterval(loadLimit, 10000);
  </script>
</body>
</html>
